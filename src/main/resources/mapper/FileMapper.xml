<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.ggshop.v1.mapper.FileMapper">

    <!-- 파일 등록 -->
    <insert id="insertFile" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tbl_file (
            file_name,
            file_size,
            file_path,
            file_status
        ) VALUES (
                     #{fileName},
                     #{fileSize},
                     #{filePath},
                     'active'
                 )
    </insert>

    <!-- 게시글-파일 연결 -->
    <insert id="insertBoardFile">
        INSERT INTO tbl_board_file (
            id,
            board_id
        ) VALUES (
                     #{fileId},
                     #{boardId}
                 )
    </insert>

    <!-- 게시글의 파일 목록 조회 -->
    <select id="selectFilesByBoardId" resultType="com.app.ggshop.v1.dto.FileDTO">
        SELECT
            f.id,
            f.file_name AS fileName,
            f.file_size AS fileSize,
            f.file_path AS filePath,
            f.file_status AS fileStatus
        FROM tbl_file f
                 INNER JOIN tbl_board_file bf ON f.id = bf.id
        WHERE bf.board_id = #{boardId}
          AND f.file_status = 'active'
    </select>

</mapper>